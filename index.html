<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>English Learning App</title>

<style>
body {
  font-family: Arial;
  padding: 16px;
  max-width: 720px;
  margin: auto;
}

input, textarea, select, button {
  width: 100%;
  margin: 6px 0;
  padding: 8px;
  font-size: 15px;
}

.toolbar, .row {
  display: flex;
  gap: 6px;
}

.toolbar button, .row button { flex: 1; }

.card {
  border: 1px solid #ccc;
  padding: 10px;
  margin-top: 10px;
  border-radius: 6px;
}

.en {
  color: #0077cc;
  margin-top: 6px;
}

.study-box {
  border: 2px solid #0077cc;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 12px;
  background: #f9fcff;
}
</style>
</head>

<body>

<h2>ğŸ“˜ English Learning App</h2>

<div class="toolbar">
  <button onclick="exportData()">ğŸ“¤ Xuáº¥t bÃ i há»c</button>
  <button onclick="importData()">ğŸ“¥ Nháº­p bÃ i há»c</button>
</div>

<h3>â• / âœï¸ ThÃªm â€“ Sá»­a cÃ¢u</h3>

<input id="structureInput" placeholder="Cáº¥u trÃºc" />
<input id="groupInput" placeholder="NhÃ³m" />
<textarea id="viInput" placeholder="CÃ¢u tiáº¿ng Viá»‡t"></textarea>
<textarea id="enInput" placeholder="CÃ¢u tiáº¿ng Anh"></textarea>

<button onclick="saveSentence()">ğŸ’¾ LÆ°u cÃ¢u</button>
<button onclick="cancelEdit()" id="cancelBtn" style="display:none;">âŒ Huá»· sá»­a</button>

<hr>

<h3>ğŸ“š Há»ŒC Tá»ªNG CÃ‚U</h3>

<div class="study-box" id="studyBox" style="display:none;">
  <b id="studyVi"></b>
  <div class="en" id="studyEn" hidden></div>

  <div class="row">
    <button onclick="speakCurrent()">ğŸ”Š Nghe</button>
    <button onclick="toggleStudyEn()">ğŸ‘ áº¨n / Hiá»‡n EN</button>
  </div>

  <div class="row">
    <button onclick="prevSentence()">â® TrÆ°á»›c</button>
    <button onclick="nextSentence()">â­ Tiáº¿p</button>
  </div>
</div>

<button onclick="startStudy()">â–¶ï¸ Báº¯t Ä‘áº§u há»c</button>

<hr>

<h3>ğŸ“‚ Ã”n táº­p</h3>

<input id="searchInput" placeholder="ğŸ” TÃ¬m cÃ¢u" oninput="renderList()" />
<select id="structureFilter" onchange="updateGroups()"></select>
<select id="groupFilter" onchange="renderList()"></select>

<div id="list"></div>

<input type="file" id="fileInput" accept=".json" style="display:none" />

<script>
const STORAGE_KEY = "english_sentences";
let editIndex = null;

/* ===== STUDY ===== */
let studyList = [];
let studyIndex = 0;
let history = [];

/* ===== DATA ===== */
function getData() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
}
function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/* ===== CRUD ===== */
function saveSentence() {
  const structure = structureInput.value.trim();
  const group = groupInput.value.trim();
  const vi = viInput.value.trim();
  const en = enInput.value.trim();
  if (!structure || !group || !vi || !en) return alert("Nháº­p Ä‘áº§y Ä‘á»§");

  const data = getData();
  editIndex !== null ? data[editIndex] = {structure,group,vi,en} : data.push({structure,group,vi,en});
  editIndex = null;
  cancelBtn.style.display = "none";
  viInput.value = enInput.value = "";
  saveData(data);
  loadFilters();
  renderList();
}

function editSentence(i){
  const s = getData()[i];
  structureInput.value=s.structure;
  groupInput.value=s.group;
  viInput.value=s.vi;
  enInput.value=s.en;
  editIndex=i;
  cancelBtn.style.display="block";
}

function cancelEdit(){ editIndex=null; cancelBtn.style.display="none"; }

function deleteSentence(i){
  if(!confirm("XoÃ¡?"))return;
  const d=getData(); d.splice(i,1); saveData(d);
  loadFilters(); renderList();
}

/* ===== FILTER ===== */
function loadFilters(){
  const d=getData();
  structureFilter.innerHTML='<option value="">-- Táº¥t cáº£ cáº¥u trÃºc --</option>';
  [...new Set(d.map(s=>s.structure))].forEach(s=>structureFilter.innerHTML+=`<option>${s}</option>`);
  updateGroups();
}
function updateGroups(){
  const d=getData(), s=structureFilter.value;
  groupFilter.innerHTML='<option value="">-- Táº¥t cáº£ nhÃ³m --</option>';
  [...new Set(d.filter(x=>!s||x.structure===s).map(x=>x.group))]
    .forEach(g=>groupFilter.innerHTML+=`<option>${g}</option>`);
  renderList();
}

/* ===== LIST ===== */
function getFiltered(){
  const d=getData(), k=searchInput.value.toLowerCase();
  return d.filter(s =>
    (!structureFilter.value||s.structure===structureFilter.value) &&
    (!groupFilter.value||s.group===groupFilter.value) &&
    (!k||s.vi.toLowerCase().includes(k)||s.en.toLowerCase().includes(k))
  );
}

function renderList(){
  list.innerHTML="";
  getFiltered().forEach((s,i)=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`
      <b>${s.vi}</b>
      <div class="row">
        <button onclick="speak('${s.en.replace(/'/g,"\\'")}')">ğŸ”Š</button>
        <button onclick="toggleEn(${i})">ğŸ‘</button>
        <button onclick="editSentence(${i})">âœï¸</button>
        <button onclick="deleteSentence(${i})">ğŸ—‘</button>
      </div>
      <div class="en" id="en-${i}" hidden>${s.en}</div>`;
    list.appendChild(c);
  });
}

/* ===== STUDY LOGIC ===== */
function startStudy(){
  studyList = [...getFiltered()].sort(()=>Math.random()-0.5);
  if(!studyList.length) return alert("KhÃ´ng cÃ³ cÃ¢u Ä‘á»ƒ há»c");
  studyIndex=0; history=[];
  studyBox.style.display="block";
  showStudy();
}

function showStudy(){
  if(studyIndex>=studyList.length){
    alert("ğŸ‰ Báº¡n Ä‘Ã£ há»c xong!");
    studyBox.style.display="none";
    return;
  }
  const s=studyList[studyIndex];
  studyVi.textContent=s.vi;
  studyEn.textContent=s.en;
  studyEn.hidden=true;
}

function nextSentence(){
  history.push(studyIndex);
  studyIndex++;
  showStudy();
}

function prevSentence(){
  if(history.length===0) return;
  studyIndex=history.pop();
  showStudy();
}

function toggleStudyEn(){ studyEn.hidden=!studyEn.hidden; }
function speakCurrent(){ speak(studyEn.textContent); }

/* ===== UTILS ===== */
function toggleEn(i){ document.getElementById("en-"+i).hidden^=1; }
function speak(t){ const u=new SpeechSynthesisUtterance(t); u.lang="en-US"; speechSynthesis.speak(u); }

/* ===== IMPORT / EXPORT ===== */
function exportData(){
  const b=new Blob([localStorage.getItem(STORAGE_KEY)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b); a.download="english.json"; a.click();
}
function importData(){ fileInput.click(); }
fileInput.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{ saveData(JSON.parse(r.result)); loadFilters(); renderList(); }
  r.readAsText(e.target.files[0]);
};

/* INIT */
loadFilters(); renderList();
</script>

</body>
</html>
