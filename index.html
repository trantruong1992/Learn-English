<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Learning App</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 15px;
}

input, button {
  width: 100%;
  padding: 8px;
  margin: 5px 0;
}

button {
  cursor: pointer;
}

.card {
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 10px;
  margin: 10px 0;
}

.en {
  color: #0066cc;
  margin-top: 5px;
}

.actions button {
  width: auto;
  margin-right: 5px;
}
</style>
</head>

<body>

<h2>â• Táº¡o cÃ¢u má»›i</h2>

<input id="viInput" placeholder="ğŸ‡»ğŸ‡³ CÃ¢u tiáº¿ng Viá»‡t">
<input id="enInput" placeholder="ğŸ‡¬ğŸ‡§ CÃ¢u tiáº¿ng Anh">
<input id="structureInput" placeholder="ğŸ“ Cáº¥u trÃºc">
<input id="groupInput" placeholder="ğŸ“‚ NhÃ³m">

<button onclick="addSentence()">ğŸ’¾ LÆ°u cÃ¢u</button>

<hr>

<h2>ğŸ“š Danh sÃ¡ch & Há»c cÃ¢u</h2>

<input
  id="searchInput"
  placeholder="ğŸ” TÃ¬m (Viá»‡t / Anh / cáº¥u trÃºc / nhÃ³m)"
  oninput="renderList()"
/>

<button onclick="shuffleSentences()">ğŸ”€ Trá»™n cÃ¢u</button>
<button onclick="startLearning()">ğŸ¯ Há»c ngáº«u nhiÃªn</button>
<button onclick="exportData()">ğŸ“¤ Xuáº¥t</button>
<input type="file" onchange="importData(event)">

<!-- ğŸ”¥ PHáº¦N Há»ŒC Tá»ªNG CÃ‚U ÄÆ¯A LÃŠN ÄÃ‚Y -->
<div id="learningArea"></div>

<div id="list"></div>

<script>
let sentences = JSON.parse(localStorage.getItem("sentences") || "[]");
let learningQueue = [];
let currentIndex = 0;

function save() {
  localStorage.setItem("sentences", JSON.stringify(sentences));
}

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

function addSentence() {
  const vi = viInput.value.trim();
  const en = enInput.value.trim();
  if (!vi || !en) return alert("Nháº­p Ä‘á»§ Viá»‡t + Anh");

  sentences.push({
    vi,
    en,
    structure: structureInput.value,
    group: groupInput.value
  });

  save();
  viInput.value = "";
  enInput.value = "";
  renderList();
}

function deleteSentence(i) {
  if (!confirm("XoÃ¡ cÃ¢u nÃ y?")) return;
  sentences.splice(i, 1);
  save();
  renderList();
}

function editSentence(i) {
  const s = sentences[i];
  s.vi = prompt("Sá»­a tiáº¿ng Viá»‡t", s.vi) || s.vi;
  s.en = prompt("Sá»­a tiáº¿ng Anh", s.en) || s.en;
  s.structure = prompt("Cáº¥u trÃºc", s.structure);
  s.group = prompt("NhÃ³m", s.group);
  save();
  renderList();
}

function toggleEn(i) {
  const el = document.getElementById("en-" + i);
  el.hidden = !el.hidden;
}

function renderList() {
  const kw = searchInput.value.toLowerCase();
  list.innerHTML = "";

  sentences.forEach((s, i) => {
    const text = `${s.vi} ${s.en} ${s.structure} ${s.group}`.toLowerCase();
    if (!text.includes(kw)) return;

    list.innerHTML += `
      <div class="card">
        <b>${s.vi}</b>
        <div id="en-${i}" class="en" hidden>${s.en}</div>
        <small>ğŸ“ ${s.structure || "-"} | ğŸ“‚ ${s.group || "-"}</small>
        <div class="actions">
          <button onclick="speak('${s.en.replace(/'/g,"\\'")}')">ğŸ”Š</button>
          <button onclick="toggleEn(${i})">ğŸ‘</button>
          <button onclick="editSentence(${i})">âœï¸</button>
          <button onclick="deleteSentence(${i})">ğŸ—‘</button>
        </div>
      </div>
    `;
  });
}

function shuffleSentences() {
  sentences.sort(() => Math.random() - 0.5);
  save();
  renderList();
}

function startLearning() {
  learningQueue = [...sentences].sort(() => Math.random() - 0.5);
  currentIndex = 0;
  showLearning();
}

function showLearning() {
  if (currentIndex >= learningQueue.length) {
    learningArea.innerHTML = `
      <div class="card">
        <b>ğŸ‰ ÄÃ£ há»c xong!</b><br><br>
        <button onclick="startLearning()">ğŸ” Há»c láº¡i</button>
      </div>
    `;
    return;
  }

  const s = learningQueue[currentIndex];
  learningArea.innerHTML = `
    <div class="card">
      <h3>${s.vi}</h3>
      <button onclick="speak('${s.en.replace(/'/g,"\\'")}')">ğŸ”Š Nghe</button>
      <button onclick="this.nextElementSibling.hidden = !this.nextElementSibling.hidden">
        ğŸ‘ Hiá»‡n / áº¨n
      </button>
      <div class="en" hidden>${s.en}</div>
      <br><br>
      <button onclick="currentIndex++; showLearning()">â¡ï¸ CÃ¢u tiáº¿p</button>
    </div>
  `;
}

function exportData() {
  const blob = new Blob([JSON.stringify(sentences)], {type: "application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "english_sentences.json";
  a.click();
}

function importData(e) {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    sentences = JSON.parse(reader.result);
    save();
    renderList();
  };
  reader.readAsText(file);
}

renderList();
</script>

</body>
</html>
