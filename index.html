<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Learning App</title>

<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 720px;
    margin: auto;
    padding: 16px;
  }
  h2, h3 { margin-top: 24px; }
  input, textarea, button {
    width: 100%;
    margin: 6px 0;
    padding: 10px;
    font-size: 16px;
  }
  button {
    cursor: pointer;
  }
  .card {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
  }
  .en {
    color: #0077cc;
    margin-top: 8px;
    display: none;
  }
  .row {
    display: flex;
    gap: 6px;
    margin-top: 10px;
  }
  .row button { flex: 1; }
</style>
</head>

<body>

<h2>ğŸ“˜ English Learning App</h2>

<!-- ================= CREATE ================= -->
<div class="card">
  <h3>â• Táº¡o cÃ¢u má»›i</h3>
  <input id="structureInput" placeholder="ğŸ“ Cáº¥u trÃºc (VD: There is / There are)">
  <input id="groupInput" placeholder="ğŸ§© NhÃ³m (VD: Trong nhÃ )">
  <textarea id="viInput" placeholder="ğŸ‡»ğŸ‡³ CÃ¢u tiáº¿ng Viá»‡t"></textarea>
  <textarea id="enInput" placeholder="ğŸ‡¬ğŸ‡§ CÃ¢u tiáº¿ng Anh"></textarea>
  <button onclick="addSentence()">ğŸ’¾ LÆ°u cÃ¢u</button>
</div>

<!-- ================= STUDY ================= -->
<div class="card">
  <h3>ğŸ¯ Há»c ngáº«u nhiÃªn</h3>
  <div id="studyArea">
    <p><b id="studyVi">ChÆ°a cÃ³ cÃ¢u</b></p>
    <p id="studyEn" class="en"></p>
  </div>

  <div class="row">
    <button onclick="toggleAnswer()">ğŸ‘ Hiá»‡n / áº¨n EN</button>
    <button onclick="speakCurrent()">ğŸ”Š Nghe</button>
    <button onclick="nextSentence()">â¡ï¸ CÃ¢u tiáº¿p theo</button>
  </div>
</div>

<!-- ================= LIST ================= -->
<div class="card">
  <h3>ğŸ“‚ Táº¥t cáº£ cÃ¢u</h3>
  <div id="list"></div>
</div>

<!-- ================= IMPORT / EXPORT ================= -->
<div class="card">
  <h3>ğŸ“¤ğŸ“¥ Sao lÆ°u</h3>
  <button onclick="exportData()">Xuáº¥t file</button>
  <button onclick="importData()">Nháº­p file</button>
  <input type="file" id="fileInput" accept=".json" hidden>
</div>

<script>
const KEY = "english_sentences";
let studyQueue = [];
let current = null;

/* ===== DATA ===== */
function getData() {
  return JSON.parse(localStorage.getItem(KEY)) || [];
}
function saveData(data) {
  localStorage.setItem(KEY, JSON.stringify(data));
}

/* ===== CREATE ===== */
function addSentence() {
  const s = structureInput.value.trim();
  const g = groupInput.value.trim();
  const vi = viInput.value.trim();
  const en = enInput.value.trim();

  if (!vi || !en) {
    alert("Pháº£i nháº­p cÃ¢u Viá»‡t vÃ  Anh");
    return;
  }

  const data = getData();
  data.push({ structure: s, group: g, vi, en });
  saveData(data);

  viInput.value = "";
  enInput.value = "";

  initStudy();
  renderList();
}

/* ===== STUDY ===== */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function initStudy() {
  studyQueue = shuffle([...getData()]);
  nextSentence();
}

function nextSentence() {
  if (studyQueue.length === 0) {
    document.getElementById("studyVi").innerText = "ğŸ‰ Báº¡n Ä‘Ã£ há»c xong táº¥t cáº£ cÃ¢u!";
    document.getElementById("studyEn").style.display = "none";
    current = null;
    return;
  }

  current = studyQueue.shift();
  document.getElementById("studyVi").innerText = current.vi;
  document.getElementById("studyEn").innerText = current.en;
  document.getElementById("studyEn").style.display = "none";
}

function toggleAnswer() {
  const en = document.getElementById("studyEn");
  en.style.display = en.style.display === "none" ? "block" : "none";
}

function speakCurrent() {
  if (!current) return;
  const u = new SpeechSynthesisUtterance(current.en);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

/* ===== LIST ===== */
function renderList() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  getData().forEach(s => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <small>ğŸ“ ${s.structure || "-"} | ğŸ§© ${s.group || "-"}</small><br>
      <b>${s.vi}</b><br>
      <span class="en" style="display:block">${s.en}</span>
    `;
    list.appendChild(div);
  });
}

/* ===== IMPORT / EXPORT ===== */
function exportData() {
  const data = localStorage.getItem(KEY);
  if (!data) return alert("KhÃ´ng cÃ³ dá»¯ liá»‡u");
  const blob = new Blob([data], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "english_sentences.json";
  a.click();
}

function importData() {
  fileInput.click();
}

fileInput.addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const json = JSON.parse(reader.result);
      if (!Array.isArray(json)) throw "";
      saveData(json);
      initStudy();
      renderList();
    } catch {
      alert("File khÃ´ng há»£p lá»‡");
    }
  };
  reader.readAsText(file);
});

/* INIT */
initStudy();
renderList();
</script>

</body>
</html>
