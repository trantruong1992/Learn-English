<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Learning App</title>

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 720px;
  margin: auto;
  padding: 16px;
}
input, textarea, button {
  width: 100%;
  margin: 6px 0;
  padding: 10px;
  font-size: 16px;
}
button { cursor: pointer; }
.card {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
  margin-top: 14px;
}
.row {
  display: flex;
  gap: 6px;
}
.row button { flex: 1; }
.en {
  color: #0077cc;
  margin-top: 8px;
  display: none;
}
small { color: #666; }
</style>
</head>

<body>

<h2>ğŸ“˜ English Learning App</h2>

<!-- ================= ADD / EDIT ================= -->
<div class="card">
  <h3>â• / âœï¸ Táº¡o â€“ Sá»­a cÃ¢u</h3>

  <input id="structureInput" placeholder="ğŸ“ Cáº¥u trÃºc (VD: There is / There are)">
  <input id="groupInput" placeholder="ğŸ§© NhÃ³m (VD: Trong nhÃ )">
  <textarea id="viInput" placeholder="ğŸ‡»ğŸ‡³ CÃ¢u tiáº¿ng Viá»‡t"></textarea>
  <textarea id="enInput" placeholder="ğŸ‡¬ğŸ‡§ CÃ¢u tiáº¿ng Anh"></textarea>

  <button onclick="saveSentence()">ğŸ’¾ LÆ°u</button>
  <button onclick="cancelEdit()" id="cancelBtn" style="display:none">âŒ Huá»· sá»­a</button>
</div>

<!-- ================= STUDY ================= -->
<div class="card">
  <h3>ğŸ¯ Há»c ngáº«u nhiÃªn</h3>

  <p><b id="studyVi">ChÆ°a cÃ³ cÃ¢u</b></p>
  <p id="studyEn" class="en"></p>

  <div class="row">
    <button onclick="toggleAnswer()">ğŸ‘ Hiá»‡n / áº¨n EN</button>
    <button onclick="speak()">ğŸ”Š Nghe</button>
    <button onclick="nextSentence()">â¡ï¸ Tiáº¿p theo</button>
  </div>
</div>

<!-- ================= LIST ================= -->
<div class="card">
  <h3>ğŸ“‚ Danh sÃ¡ch cÃ¢u</h3>
  <div id="list"></div>
</div>

<!-- ================= IMPORT / EXPORT ================= -->
<div class="card">
  <h3>ğŸ“¤ğŸ“¥ Sao lÆ°u</h3>
  <button onclick="exportData()">Xuáº¥t file</button>
  <button onclick="importData()">Nháº­p file</button>
  <input type="file" id="fileInput" accept=".json" hidden>
</div>

<script>
const KEY = "english_sentences";
let editIndex = null;
let queue = [];
let current = null;

/* ===== DATA ===== */
const getData = () => JSON.parse(localStorage.getItem(KEY)) || [];
const saveData = d => localStorage.setItem(KEY, JSON.stringify(d));

/* ===== ADD / EDIT ===== */
function saveSentence() {
  const s = structureInput.value.trim();
  const g = groupInput.value.trim();
  const vi = viInput.value.trim();
  const en = enInput.value.trim();

  if (!vi || !en) return alert("Pháº£i nháº­p cÃ¢u Viá»‡t vÃ  Anh");

  const data = getData();

  if (editIndex !== null) {
    data[editIndex] = { structure: s, group: g, vi, en };
    editIndex = null;
    cancelBtn.style.display = "none";
  } else {
    data.push({ structure: s, group: g, vi, en });
  }

  saveData(data);
  viInput.value = "";
  enInput.value = "";
  initStudy();
  renderList();
}

function editSentence(i) {
  const s = getData()[i];
  structureInput.value = s.structure;
  groupInput.value = s.group;
  viInput.value = s.vi;
  enInput.value = s.en;
  editIndex = i;
  cancelBtn.style.display = "block";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function cancelEdit() {
  editIndex = null;
  viInput.value = "";
  enInput.value = "";
  cancelBtn.style.display = "none";
}

function deleteSentence(i) {
  if (!confirm("XoÃ¡ cÃ¢u nÃ y?")) return;
  const data = getData();
  data.splice(i, 1);
  saveData(data);
  initStudy();
  renderList();
}

/* ===== STUDY ===== */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}

function initStudy() {
  queue = shuffle([...getData()]);
  nextSentence();
}

function nextSentence() {
  if (queue.length === 0) {
    studyVi.innerText = "ğŸ‰ Báº¡n Ä‘Ã£ há»c xong táº¥t cáº£ cÃ¢u!";
    studyEn.style.display = "none";
    current = null;
    return;
  }
  current = queue.shift();
  studyVi.innerText = current.vi;
  studyEn.innerText = current.en;
  studyEn.style.display = "none";
}

function toggleAnswer() {
  studyEn.style.display =
    studyEn.style.display === "none" ? "block" : "none";
}

function speak() {
  if (!current) return;
  const u = new SpeechSynthesisUtterance(current.en);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

/* ===== LIST ===== */
function renderList() {
  list.innerHTML = "";
  getData().forEach((s, i) => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <small>ğŸ“ ${s.structure || "-"} | ğŸ§© ${s.group || "-"}</small><br>
      <b>${s.vi}</b>
      <div class="en" style="display:block">${s.en}</div>
      <div class="row">
        <button onclick="editSentence(${i})">âœï¸ Sá»­a</button>
        <button onclick="deleteSentence(${i})">ğŸ—‘ XoÃ¡</button>
      </div>
    `;
    list.appendChild(div);
  });
}

/* ===== IMPORT / EXPORT ===== */
function exportData() {
  const data = localStorage.getItem(KEY);
  if (!data) return alert("KhÃ´ng cÃ³ dá»¯ liá»‡u");
  const blob = new Blob([data], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "english_sentences.json";
  a.click();
}

function importData() {
  fileInput.click();
}

fileInput.onchange = () => {
  const file = fileInput.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const json = JSON.parse(reader.result);
      if (!Array.isArray(json)) throw "";
      saveData(json);
      initStudy();
      renderList();
    } catch {
      alert("File khÃ´ng há»£p lá»‡");
    }
  };
  reader.readAsText(file);
};

/* INIT */
initStudy();
renderList();
</script>

</body>
</html>
