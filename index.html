<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>English Learning App</title>

  <style>
    body {
      font-family: Arial;
      padding: 16px;
      max-width: 720px;
      margin: auto;
    }

    input, textarea, select, button {
      width: 100%;
      margin: 6px 0;
      padding: 8px;
      font-size: 15px;
    }

    .toolbar {
      display: flex;
      gap: 6px;
      margin-bottom: 10px;
    }

    .toolbar button {
      flex: 1;
    }

    .card {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
    }

    .row {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }

    .row button {
      flex: 1;
    }

    .en {
      color: #0077cc;
      margin-top: 6px;
      display: none;
    }

    #searchInput {
      padding: 10px;
      margin: 12px 0;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
</head>

<body>

<h2>üìò English Learning App</h2>

<div class="toolbar">
  <button onclick="exportData()">üì§ Xu·∫•t b√†i h·ªçc</button>
  <button onclick="importData()">üì• Nh·∫≠p b√†i h·ªçc</button>
</div>

<h3>‚ûï / ‚úèÔ∏è Th√™m ‚Äì S·ª≠a c√¢u</h3>

<input id="structureInput" placeholder="C·∫•u tr√∫c (VD: There is / There are)" />
<input id="groupInput" placeholder="Nh√≥m (VD: Trong nh√†)" />
<textarea id="viInput" placeholder="C√¢u ti·∫øng Vi·ªát"></textarea>
<textarea id="enInput" placeholder="C√¢u ti·∫øng Anh"></textarea>

<button onclick="saveSentence()">üíæ L∆∞u c√¢u</button>
<button onclick="cancelEdit()" id="cancelBtn" style="display:none;">‚ùå Hu·ª∑ s·ª≠a</button>

<hr>

<h3>üìÇ √în t·∫≠p</h3>

<input
  type="text"
  id="searchInput"
  placeholder="üîç T√¨m c√¢u (Vi·ªát / Anh / c·∫•u tr√∫c / nh√≥m)"
  oninput="renderList()"
/>

<select id="structureFilter" onchange="updateGroups()"></select>
<select id="groupFilter" onchange="renderList()"></select>

<div id="list"></div>

<input type="file" id="fileInput" accept=".json" style="display:none" />

<script>
const STORAGE_KEY = "english_sentences";
let editIndex = null;

/* ===== DATA ===== */

function getData() {
  return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
}

function saveData(data) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

/* ===== CRUD ===== */

function saveSentence() {
  const structure = structureInput.value.trim();
  const group = groupInput.value.trim();
  const vi = viInput.value.trim();
  const en = enInput.value.trim();

  if (!structure || !group || !vi || !en) {
    alert("Nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin");
    return;
  }

  const data = getData();

  if (editIndex !== null) {
    data[editIndex] = { structure, group, vi, en };
    editIndex = null;
    cancelBtn.style.display = "none";
  } else {
    data.push({ structure, group, vi, en });
  }

  saveData(data);
  viInput.value = "";
  enInput.value = "";

  loadFilters();
  renderList();
}

function editSentence(index) {
  const s = getData()[index];
  structureInput.value = s.structure;
  groupInput.value = s.group;
  viInput.value = s.vi;
  enInput.value = s.en;
  editIndex = index;
  cancelBtn.style.display = "block";
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function cancelEdit() {
  editIndex = null;
  viInput.value = "";
  enInput.value = "";
  cancelBtn.style.display = "none";
}

function deleteSentence(index) {
  if (!confirm("Xo√° c√¢u n√†y?")) return;
  const data = getData();
  data.splice(index, 1);
  saveData(data);
  loadFilters();
  renderList();
}

/* ===== FILTER ===== */

function loadFilters() {
  const data = getData();
  const structures = [...new Set(data.map(s => s.structure))];

  structureFilter.innerHTML = `<option value="">-- T·∫•t c·∫£ c·∫•u tr√∫c --</option>`;
  structures.forEach(s => {
    structureFilter.innerHTML += `<option value="${s}">${s}</option>`;
  });

  groupFilter.innerHTML = `<option value="">-- T·∫•t c·∫£ nh√≥m --</option>`;
}

function updateGroups() {
  const data = getData();
  const structure = structureFilter.value;

  const groups = [...new Set(
    data.filter(s => !structure || s.structure === structure)
        .map(s => s.group)
  )];

  groupFilter.innerHTML = `<option value="">-- T·∫•t c·∫£ nh√≥m --</option>`;
  groups.forEach(g => {
    groupFilter.innerHTML += `<option value="${g}">${g}</option>`;
  });

  renderList();
}

/* ===== RENDER + SEARCH ===== */

function renderList() {
  const data = getData();
  const structure = structureFilter.value;
  const group = groupFilter.value;
  const keyword = searchInput.value.toLowerCase();

  list.innerHTML = "";

  data.forEach((s, i) => {

    if (
      keyword &&
      !(
        s.vi.toLowerCase().includes(keyword) ||
        s.en.toLowerCase().includes(keyword) ||
        s.structure.toLowerCase().includes(keyword) ||
        s.group.toLowerCase().includes(keyword)
      )
    ) return;

    if (
      (structure && s.structure !== structure) ||
      (group && s.group !== group)
    ) return;

    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <b>${s.vi}</b>
      <div class="row">
        <button onclick="speak('${s.en.replace(/'/g,"\\'")}')">üîä Nghe</button>
        <button onclick="editSentence(${i})">‚úèÔ∏è S·ª≠a</button>
        <button onclick="deleteSentence(${i})">üóë Xo√°</button>
      </div>
      <button onclick="toggleEn(${i})">üëÅ Hi·ªán / ·∫®n EN</button>
      <div class="en" id="en-${i}">${s.en}</div>
    `;
    list.appendChild(div);
  });
}

/* ===== UTILS ===== */

function toggleEn(i) {
  const el = document.getElementById("en-" + i);
  el.style.display = el.style.display === "none" ? "block" : "none";
}

function speak(text) {
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  speechSynthesis.speak(u);
}

/* ===== IMPORT / EXPORT ===== */

function exportData() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (!data) {
    alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t");
    return;
  }
  const blob = new Blob([data], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "english_sentences.json";
  a.click();
}

function importData() {
  fileInput.click();
}

fileInput.addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const json = JSON.parse(e.target.result);
      if (!Array.isArray(json)) throw "";
      if (!confirm("Nh·∫≠p d·ªØ li·ªáu s·∫Ω ghi ƒë√® d·ªØ li·ªáu hi·ªán t·∫°i. Ti·∫øp t·ª•c?")) return;
      localStorage.setItem(STORAGE_KEY, JSON.stringify(json));
      loadFilters();
      renderList();
      alert("Nh·∫≠p d·ªØ li·ªáu th√†nh c√¥ng");
    } catch {
      alert("File kh√¥ng h·ª£p l·ªá");
    }
  };
  reader.readAsText(file);
});

/* ===== INIT ===== */

loadFilters();
renderList();
</script>

</body>
</html>
